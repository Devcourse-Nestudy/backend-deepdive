# Partitioning & Sharding & Replication

## 1. 파티셔닝 (Partitioning)

### 정의
- 데이터를 **하나의 데이터베이스 내에서 논리적으로 분할**하여 저장하는 방식.
- 주로 **테이블 단위**로 분할되며, 데이터베이스 엔진에서 파티셔닝 기능을 지원.

### 목적
- **쿼리 성능 향상**: 필요한 파티션만 조회
- **관리 용이성**: 특정 기간 데이터 삭제, 이동이 쉬움
- **대용량 데이터 처리**: 데이터 양이 많을수록 유리

### 종류
1. **Range Partitioning**: 특정 범위에 따라 분할 (예: 날짜별)
2. **List Partitioning**: 특정 값 목록으로 분할 (예: 지역 코드)
3. **Hash Partitioning**: 해시 함수를 사용하여 균등 분산
4. **Composite Partitioning**: 둘 이상의 방식 혼합

### 예시 (MySQL)
```sql
CREATE TABLE orders (
  id INT,
  order_date DATE
)
PARTITION BY RANGE (YEAR(order_date)) (
  PARTITION p2023 VALUES LESS THAN (2024),
  PARTITION p2024 VALUES LESS THAN (2025)
);
```

---

## 2. 샤딩 (Sharding)

### 정의
- **수평적 스케일링 방식**으로 데이터를 **여러 DB 인스턴스에 분산** 저장.
- 각 샤드는 별도의 물리적인 데이터베이스 서버.

### 목적
- **성능 분산**: 부하 분산, 트래픽 분산
- **수평 확장성**: 서버를 추가하여 성능 확장
- **대용량 처리**: 많은 데이터를 여러 서버에 분산

### 샤딩 키(Sharding Key)
- 데이터를 어떤 샤드에 저장할지 결정하는 기준 필드 (예: 사용자 ID, 지역 등)

### 샤딩 방식
1. **Hash-based Sharding**: 샤딩 키에 해시 함수 적용 → 균등 분산
2. **Range-based Sharding**: 값의 범위에 따라 샤드 선택
3. **Directory-based Sharding**: 라우팅 정보를 테이블에 따로 관리

### 단점
- **조인 처리 어려움**: 서로 다른 샤드 간 조인 복잡
- **재샤딩 복잡**: 샤딩 키 변경 시 데이터 이동 필요
- **복잡한 라우팅**: 데이터 위치 추적 필요

---

## 3. 레플리케이션 (Replication)

### 정의
- 데이터를 **한 DB에서 다른 DB로 복제**하여 **복사본을 유지**하는 기술
- 일반적으로 **Master-Slave** 또는 **Primary-Replica** 구조 사용

### 목적
- **고가용성**: 하나의 DB 장애 시 다른 복제본 사용 가능
- **읽기 성능 향상**: 읽기 트래픽 분산
- **백업 및 장애 복구**: 복제본으로 복구 가능

### 유형
1. **비동기 레플리케이션**: Master가 먼저 반영, 이후 Replica 반영 (속도 빠름, 데이터 지연 발생 가능)
2. **동기 레플리케이션**: 모든 Replica 반영 완료 후 Master 커밋 (일관성 높음, 성능 낮음)
3. **다중 마스터 레플리케이션**: 여러 노드가 동시에 쓰기 가능 (복잡도 매우 높음)

### 예시 구조
```
Primary (쓰기 + 읽기)
   |
  / \
Replica1 Replica2 ... (읽기 전용)
```

---

## 4. 요약 비교
| 항목 | 파티셔닝 | 샤딩 | 레플리케이션 |
|------|-----------|--------|----------------|
| 위치 | 단일 DB 내 | 여러 DB 서버 | 복제본 DB |
| 목적 | 쿼리 최적화, 관리 편의 | 확장성, 부하 분산 | 고가용성, 읽기 분산 |
| 구조 | 논리적 분할 | 물리적 분할 | 복제 구조 |
| 주 용도 | OLAP, 대용량 테이블 | 트래픽 많은 시스템 | 가용성 및 트래픽 분산 |
| 단점 | 파티션 관리 필요 | 조인, 재샤딩 어려움 | 쓰기 확장 어려움 |

---

## 5. 함께 사용하는 전략
- **샤딩 + 레플리케이션**: 샤드 각각에 레플리카 구성 → 확장성과 가용성 모두 확보
- **파티셔닝 + 샤딩**: 샤드 내에서 다시 파티셔닝 → 성능 최적화

---

## 6. 참고자료
- MySQL/MariaDB 공식 문서
- MongoDB, PostgreSQL 샤딩/레플리케이션 문서
- 대형 분산 시스템 사례 (Netflix, Facebook, Kakao 등)